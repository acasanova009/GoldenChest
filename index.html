<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Golden Chest</title>
  <style>
   :root{
  --bg:#0b0f1a;
  --card:#121829;
  --muted:#9aa4b2;
  --accent:#f5d142;   /* light golden yellow */
  --accent2:#c99200;  /* deeper golden */
  --border:#1e263d;
  --ok:#27ae60;
  --err:#e74c3c;
  --text:#e6ecf2;
  --input:#0d1428;
  --out:#0a1122;
}

    .light{
  --bg:#f6f7fb;
  --card:#ffffff;
  --muted:#596274;
  --accent:#f7d85f;   /* warm yellow */
  --accent2:#d4a017;  /* gold */
  --border:#dfe4ef;
  --ok:#1e874c;
  --err:#c0392b;
  --text:#0b1220;
  --input:#f1f3fa;
  --out:#eef2ff;
}

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg,var(--bg) 0%, var(--bg) 100%); color:var(--text);
      font:16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    header{
      position:sticky; top:0; z-index:100;
      background:linear-gradient(90deg, rgba(255,223,128,0.15), rgba(204,153,0,0.15));

      border-bottom:1px solid var(--border);
      backdrop-filter: blur(6px);
    }
    .wrap{max-width:1100px; margin:0 auto; padding:16px;}
    .hero{
      padding:24px 0 12px; display:flex; gap:18px; align-items:center; justify-content:space-between; flex-wrap:wrap;
    }
    .left{display:flex; gap:18px; align-items:center}
    .hero .logo{
      width:60px; height:60px; border-radius:14px;
      background: radial-gradient(100% 100% at 30% 30%, var(--accent) 0%, var(--accent2) 100%);
      box-shadow: 0 10px 24px rgba(0,0,0,.20), inset 0 0 18px rgba(255,255,255,.18);
    }
    .hero h1{margin:0; font-weight:700; letter-spacing:.3px;}
    .hero p{margin:.2rem 0 0; color:var(--muted); max-width:60ch}
    main{padding:22px 0 60px;}
    .grid{display:grid; grid-template-columns:repeat(12,1fr); gap:18px;}
    .full{grid-column:1/-1}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.00));
      border:1px solid var(--border); border-radius:16px; padding:18px;
      box-shadow: 0 8px 30px rgba(0,0,0,.12);
    }
    h2{margin:.2rem 0 1rem; font-size:1.15rem; letter-spacing:.2px}
    label{display:block; font-size:.92rem; color:var(--muted); margin:.3rem 0 .3rem}
    input[type="text"],input[type="number"],input[type="password"],textarea{
      width:100%; background:var(--input); color:var(--text); border:1px solid var(--border);
      border-radius:10px; padding:10px 12px; outline:none;
    }
    textarea{min-height:120px; resize:vertical;}
    .row{display:flex; gap:10px; flex-wrap:wrap}
    .row > *{flex:1}
    .btn, .btn.secondary{
      display:inline-flex; align-items:center; gap:8px;
      background:linear-gradient(90deg, var(--accent) 0%, var(--accent2) 100%);
      color:#0a0d18; font-weight:700; border:none; border-radius:999px; padding:10px 14px; cursor:pointer;
    }
    /* Hover effect */
.btn:hover {
  background: #f5d142; /* original yellow tone */
}

#themeBtn:hover
{
  background: #949494; /* original yellow tone */
}

/* Click (active) effect */
.btn:active{
  transform: scale(0.97);
  /*background:linear-gradient(90deg, #ffe58f 0%, #d4af37 100%); /* golden flash */
}
    
    .btn:disabled{opacity:.6; cursor:not-allowed}
    .muted{color:var(--muted); font-size:.9rem}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;}
    .small{font-size:.85rem}
    .out{white-space:pre-wrap; word-break:break-all; background:var(--out); padding:10px; border-radius:10px; border:1px dashed var(--border)}
    .iconbtn{
      display:inline-flex; align-items:center; gap:6px; padding:8px 12px; border-radius:999px; border:1px solid var(--border); background:transparent; color:var(--text); cursor:pointer;
    }
    .toggle-wrap{display:flex; align-items:center; gap:10px}
    .pw-wrap{position:relative}
    .pw-wrap button{
      position:absolute; right:8px; top:50%; transform:translateY(-50%);
      background:#0000; border:1px solid var(--border); border-radius:999px; padding:4px 8px; color:var(--muted); cursor:pointer;
    }
    .notice{padding:10px 12px; border:1px solid var(--border); border-radius:12px; background:#0c142c; color:var(--muted);}
    .light .notice{background:#f2f5ff;}
  </style>
</head>
<body>
  <header>
    <div class="wrap hero">
      <div class="left">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Golden Chest</h1>
          <p class="muted">Encrypt and decrypt your Golden Chest with a key, and split that key in many shares.</p>
        </div>
      </div>
      <div class="toggle-wrap">
        <button id="themeBtn" class="iconbtn" title="Change theme">üåô/‚òÄÔ∏è Theme</button>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap grid">
<section class="card full" id="shamir">
        <h2>Split Key</h2>
        <p class="muted">
  Use the advanced Shamir Secret Sharing algorithm to split a key into many shares ‚Äî requiring only <em>t</em> out of <em>n</em> to recover it.  
  Example: <strong>3 out of 5 shares</strong>.
</p>
        <label for="shamir-secret">Key</label>
        <input type="text" id="shamir-secret" placeholder="Enter a secure password" />
        <div class="row">
          
          <div>
            <label for="shamir-t">Threshold (t)</label>
            <input type="number" id="shamir-t" min="2" value="3"/>
          </div>
          <div>
            <label for="shamir-n">Participants (n)</label>
            <input type="number" id="shamir-n" min="2" value="5"/>
          </div>
          
        </div>

        <div class="row" style="margin-top:8px">
          <button class="btn" id="btn-split">Split</button>
          <button class="btn secondary" id="btn-join">Reconstruct</button>
          
          
        </div>

        <div class="muted small" style="margin-top:10px">Shares (one per line, format <code>x:HEX</code>)</div>
        <textarea id="shamir-shares" placeholder="Example:
5:4fa1b2
2:03c9aa
8:8f4w2f
3:...
"></textarea>

        <div class="muted small" style="margin-top:10px">Output</div>
        <div class="out mono small" id="shamir-out"></div>
      </section>
<section class="card full" id="aes">
        <h2>Golden Chest Encryption & Decryption</h2>
<p class="muted">
  Encrypt and decrypt your Golden Chest content using your key. Protected with AES-GCM, PBKDF2 (500,000 iterations) for strong protection.
</p>

        <div class="pw-wrap">
          <label for="aes-pass">Key</label>
          <input type="password" id="aes-pass" placeholder="Enter a secure password" />
          <button id="togglePass" aria-label="Show or hide password">üëÅÔ∏è</button>
        </div>
        <label for="aes-plain">Golden Chest Content</label>
        <textarea id="aes-plain" placeholder="Plain text to encrypt (e.g., your seed phrases) or Base64 ciphertext to decrypt"></textarea>
        <div class="row" style="margin-top:8px">
          <button class="btn" id="btn-encrypt">Encrypt</button>
          <button class="btn secondary" id="btn-decrypt">Decrypt</button>
          <button class="btn secondary" id="btn-copy-aes" title="Copy output">Copy output</button>
        </div>
        <div class="muted small" style="margin-top:10px">Output</div>
        <div class="out mono small" id="aes-out"></div>
      </section>
      <!-- AES (arriba) -->
      

      <!-- Shamir (abajo) -->
      
    </div>
  </main>

  <footer class="wrap muted small" style="text-align:center">
    Made for my family.
  </footer>

<script>
// ========= Theme d√≠a/noche =========
const root = document.documentElement;
const savedTheme = localStorage.getItem('theme') || 'dark';
if(savedTheme==='light') document.body.classList.add('light');
document.getElementById('themeBtn').addEventListener('click', () => {
  document.body.classList.toggle('light');
  localStorage.setItem('theme', document.body.classList.contains('light') ? 'light' : 'dark');
});

// ========= Utils =========
const $ = sel => document.querySelector(sel);
const enc = new TextEncoder();
const dec = new TextDecoder();
function toHex(u8){ return Array.from(u8, b => b.toString(16).padStart(2,'0')).join(''); }
function fromHex(hex){
  hex = hex.replace(/^0x/,'').replace(/\s+/g,'');
  if(!/^[0-9a-fA-F]*$/.test(hex) || hex.length % 2) throw new Error('HEX inv√°lido');
  const out = new Uint8Array(hex.length/2);
  for(let i=0;i<out.length;i++){ out[i] = parseInt(hex.slice(2*i,2*i+2),16); }
  return out;
}
function b64e(u8){ return btoa(String.fromCharCode(...u8)); }
function b64d(b64){
  const bin = atob(b64.trim());
  const out = new Uint8Array(bin.length);
  for(let i=0;i<bin.length;i++) out[i] = bin.charCodeAt(i);
  return out;
}
function parseSecretInput(str){
  str = str.trim();
  if(/^0x[0-9a-fA-F]+$/.test(str)) return fromHex(str);
  return enc.encode(str);
}
function randomBytes(n){ const a=new Uint8Array(n); crypto.getRandomValues(a); return a; }

// ========= AES-GCM con PBKDF2 =========
async function deriveKey(password, salt){
  const base = await crypto.subtle.importKey('raw', enc.encode(password), 'PBKDF2', false, ['deriveKey']);
  return crypto.subtle.deriveKey(
    { name:'PBKDF2', hash:'SHA-256', salt, iterations:500000 },
    base,
    { name:'AES-GCM', length:256 },
    false,
    ['encrypt','decrypt']
  );
}
async function aesEncrypt(){
  const pass = $('#aes-pass').value;
  const text = $('#aes-plain').value;
  if(!pass || !text){ $('#aes-out').textContent='Missing password or text.'; return; }
  const salt = crypto.getRandomValues(new Uint8Array(16));
  const iv = crypto.getRandomValues(new Uint8Array(12));
  const key = await deriveKey(pass, salt);
  const ct = new Uint8Array(await crypto.subtle.encrypt({name:'AES-GCM', iv}, key, enc.encode(text)));
  const packed = new Uint8Array(salt.length + iv.length + ct.length);
  packed.set(salt,0); packed.set(iv,16); packed.set(ct,28);
  $('#aes-out').textContent = b64e(packed);
}
async function aesDecrypt(){
  try{
    const pass = $('#aes-pass').value;
    const b64 = $('#aes-plain').value.trim();
    if(!pass || !b64){ $('#aes-out').textContent='Missing password or encrypted text.'; return; }
    const packed = b64d(b64);
    if(packed.length < 29) throw new Error('Incorrect format.');
    const salt = packed.slice(0,16);
    const iv = packed.slice(16,28);
    const ct = packed.slice(28);
    const key = await deriveKey(pass, salt);
    const pt = await crypto.subtle.decrypt({name:'AES-GCM', iv}, key, ct);
    $('#aes-out').textContent = dec.decode(pt);
  }catch(e){
    $('#aes-out').textContent = 'Error decrypting: ' + e.message;
  }
}
$('#btn-encrypt').addEventListener('click', aesEncrypt);
$('#btn-decrypt').addEventListener('click', aesDecrypt);
$('#btn-copy-aes').addEventListener('click', () => navigator.clipboard.writeText($('#aes-out').textContent||''));

// Mostrar/ocultar contrase√±a
$('#togglePass').addEventListener('click', () => {
  const inp = $('#aes-pass');
  inp.type = inp.type === 'password' ? 'text' : 'password';
});

// ========= Shamir Secret Sharing (GF(256)) =========
const GF256 = (()=>{
  const mul = (a,b)=>{
    let p=0;
    for(let i=0;i<8;i++){
      if(b & 1) p ^= a;
      const hi = a & 0x80;
      a = (a << 1) & 0xFF;
      if(hi) a ^= 0x1b;
      b >>= 1;
    }
    return p;
  };
  const pow = new Uint8Array(512);
  const log = new Uint8Array(256);
  let x=1;
  for(let i=0;i<255;i++){
    pow[i]=x; log[x]=i;
    x = mul(x, 0x03);
  }
  for(let i=255;i<512;i++) pow[i]=pow[i-255];
  const inv = (a)=> a===0 ? 0 : pow[255 - log[a]];
  const add = (a,b)=> a ^ b;
  const mulL = (a,b)=>{
    if(a===0||b===0) return 0;
    return pow[ (log[a] + log[b]) % 255 ];
  };
  return {add, mul: mulL, inv};
})();

function polyEval(coeffs, x){
  let y = 0, xp = 1;
  for(let c of coeffs){ y = GF256.add(y, GF256.mul(c, xp)); xp = GF256.mul(xp, x); }
  return y;
}
function shamirSplit(secretBytes, n, t){
  if(!(t>=2 && t<=n)) throw new Error('Par√°metros inv√°lidos: 2 ‚â§ t ‚â§ n');
  const shares = Array.from({length:n}, (_,i)=>({x:i+1, y:new Uint8Array(secretBytes.length)}));
  for(let bi=0; bi<secretBytes.length; bi++){
    const coeffs = new Uint8Array(t);
    coeffs[0] = secretBytes[bi];
    for(let j=1;j<t;j++) coeffs[j] = randomBytes(1)[0];
    for(let s=0;s<n;s++){ shares[s].y[bi] = polyEval(coeffs, shares[s].x); }
  }
  return shares;
}
function lagrangeAt0(points){
  let acc = 0, k = points.length;
  for(let i=0;i<k;i++){
    const xi = points[i].x, yi = points[i].yByte;
    let num = 1, den = 1;
    for(let j=0;j<k;j++){
      if(i===j) continue;
      const xj = points[j].x;
      num = GF256.mul(num, xj);
      den = GF256.mul(den, xi ^ xj);
    }
    const li0 = GF256.mul(num, GF256.inv(den));
    acc ^= GF256.mul(yi, li0);
  }
  return acc;
}
function shamirJoin(shares){
  const k = shares.length;
  if(k<2) throw new Error('Se requieren al menos 2 acciones');
  const len = shares[0].y.length;
  for(const s of shares) if(s.y.length !== len) throw new Error('Acciones con longitudes diferentes');
  const out = new Uint8Array(len);
  for(let bi=0; bi<len; bi++){
    const pts = shares.map(s => ({x:s.x, yByte:s.y[bi]}));
    out[bi] = lagrangeAt0(pts);
  }
  return out;
}

$('#btn-split').addEventListener('click', () => {
  try{
    const n = parseInt($('#shamir-n').value,10);
    const t = parseInt($('#shamir-t').value,10);
    let secret = parseSecretInput($('#shamir-secret').value || '');
    if(secret.length===0) throw new Error('Empty secret.');
    const shares = shamirSplit(secret, n, t);
    const lines = shares.map(s => `${s.x}:${toHex(s.y)}`);
    $('#shamir-shares').value = lines.join('\n');
    $('#shamir-out').textContent = `Shares generated (${t}-de-${n}). Length per share: ${shares[0].y.length} bytes.`;
  }catch(e){
    $('#shamir-out').textContent = 'Error: ' + e.message;
  }
});

$('#btn-join').addEventListener('click', () => {
  try{
    const lines = $('#shamir-shares').value.trim().split(/\n+/).filter(Boolean);
    const shares = lines.map(line => {
      const m = line.trim().match(/^(\d+)\s*:\s*([0-9a-fA-F]+)$/);
      if(!m) throw new Error(`Invalid line: ${line}`);
      return { x: parseInt(m[1],10), y: fromHex(m[2]) };
    });
    const secret = shamirJoin(shares);
    let decoded; try{ decoded = dec.decode(secret); }catch{ decoded = null; }

      // 
    if (decoded && decoded.length) {
      $('#aes-pass').value = decoded;
      // (optional) give a tiny visual cue:
      $('#aes-pass').animate([{outline:'2px solid var(--accent)'},{outline:'none'}], {duration:800});
    }
    // 


    const msg = `Secret (HEX): 0x${toHex(secret)}\n` + (decoded ? `Secret (UTF‚Äë8): ${decoded}` : '');
    $('#shamir-out').textContent = msg;
  }catch(e){
    $('#shamir-out').textContent = 'Error: ' + e.message;
  }
});

// Copiar acciones (con x:)
$('#btn-copy-shamir-all').addEventListener('click', () => {
  const txt = $('#shamir-shares').value || '';
  navigator.clipboard.writeText(txt);
});
// Copiar solo HEX (sin "x:")
$('#btn-copy-shamir-hex').addEventListener('click', () => {
  const lines = $('#shamir-shares').value.trim().split(/\n+/).filter(Boolean);
  const onlyHex = lines.map(l => {
    const m = l.match(/^(\d+)\s*:\s*([0-9a-fA-F]+)$/); return m ? m[2] : l;
  }).join('\n');
  navigator.clipboard.writeText(onlyHex);
});
</script>
</body>
</html>
